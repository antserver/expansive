<!DOCTYPE html>
<html lang="eng">
<head>
<title>Exp Man Page</title>
</head>
<body><pre>
exp(1)                           user commands                          exp(1)

<b>name</b>
       exp - embedthis expansive -- static web site generator using ejscript

<b>synopsis</b>
       <b>exp</b>
           <b>--chdir directory</b>
           <b>--keep</b>
           <b>--listen ip:port</b>
           <b>--log path:level</b>
           <b>--noclean</b>
           <b>--norender</b>
           <b>--nowatch</b>
           <b>--quiet</b>
           <b>--trace path:level</b>
           <b>--verbose dir</b>
           <b>--version</b>
           <b>commands ...</b>

       <b>commands:</b>
           clean
           init
           install
           render
           filters ...
           upgrade
           uninstall
           watch
           &lt;cr&gt;

<b>description</b>
       <b>expansive  </b>is  a  static web site generator using ejscript.  it quickly
       creates static html pages from layouts, partials and content pages.

<b>why expansive?</b>
       there are many static site generators, why another one?  existing  site
       generators are often slow, very slow, painfully slow.  when creating or
       managing a web site, you need tools that  do  not  delay  the  creative
       design process. they need to be as fast as possible. expansive is fast,
       pure and simple.

       other site generators frequently provide poor  diagnostics.  fine  when
       everything  works,  but  when a page fails to render due to a scripting
       error -- debugging can be a nightmare. expansive  shows  exactly  where
       errors occur.

<b>features</b>
       expansive  is implemented primarily as a single script of some 1k lines
       of ejscript and is very hackable.  it has the following major features:

           .  generate  static  web  sites  from  pages, layouts, partials and
       scripts
           . ejscript templates for dynamic content
           . layout pages to define the look and feel of site
           . partial pages to include replicated content
           . per-page meta data to control layouts and partials
           . integrated web server to serve content
           . watches for changes and automatically render site
           . scripting support via change events
           . automatic sitemap creation
           . content transition pipeline
           . open plugin architecture

<b>nice parts</b>
       while expansive has a strong feature set, there are  some  characteris-
       tics that make expansive particularly sweet.

           . fast, fast, fast
           . full power of ejscript in every page
           .  very simple code. by leveraging ejscript, the code is simple and
       clean
           . easy to create and install new plugins
           . great diagnostics when things go wrong

<b>basic usage</b>
       to prepare a directory for expansive and create an exp.json  configura-
       tion file:
           exp init

       to  install  new  plugins  to  transform content. the exp-less compiles
       *.less into css.
           exp install exp-less

       to render a site from 'documents' into 'public'
           exp render

       to serve content and watch for changes
           exp

       to watch for changes but not serve
           exp watch

       to render a matching set of documents
           exp documents/index.html
           exp documents/manual

       to clean the rendered site under 'public'
           exp clean

<b>directories</b>
       expansive uses the following directories:

           layouts     for master page layouts
           partials    for partial web pages that can  be  included  by  other
       pages
           documents   input web pages to be processed
           files       files to be copied and not processed
           public      final output directory containing the rendered web site

       these directories can be modified via the 'directories' object  in  the
       meta 'control' collection.

<b>processing</b>
       expansive  operates by processing web pages from the 'documents' direc-
       tory. it uses layout pages from the 'layouts'  directory  and  includes
       partial  pages  from  the 'partials' directory. raw files may be copied
       from the 'files' directory.  content is rendered to the 'public' output
       directory.

<b>configuration</b>
       expansive  is  controlled  by  a  'exp.json'  configuration  file. this
       defines top level configuration for the site and controls how expansive
       renders  the  site.  an  exp.json file must be present for expansive to
       render content.

       to prepare a new site to use expansive, run:

           exp init

       this creates an exp.json file similar to that below:

             {
                title: 'home page title',
                url: 'home page url',
                description: 'meta data description (optional)',
                keywords: 'meta data keywords (optional)',
             }

       the contents of the exp.json file are added to the expansive meta  data
       collection  that  is  provided  to  every page, layout and partial. the
       exp.json file has a 'control' section that controls  the  operation  of
       expansive.  the  are  a  set of pre-defined properties, but you can add
       your own data as well. see the meta properties section below.

       in the control section, the 'exclude' array defines a set of file  pat-
       terns  to  exclude  from  processing. the 'copy' array defines a set of
       file patterns to copy without processing. these patterns  are  relative
       to  the  'documents'  directory.  the script string defines an optional
       global script to inject code into the ejscript execution  context.  the
       sitemap  collection configures what documents to include in the created
       sitemap xml file.

<b>dynamic content</b>
       expansive uses embedded  javascript  in  web  pages  to  fully  support
       dynamic content.  scripts can be embedded via the special expansive tag
       '&lt;@ ...  @&gt;'. this will run the script when the page  is  rendered  and
       replace  the  script  with  rendered  data.   when the script runs, the
       'this' object is set to the  'expansive'  object  for  easy  access  to
       expansive methods. see scripting below for more details.

       for example, to render the current date in a document:

        &lt;p&gt;today is &lt;@ write(date()) @&gt;

       the write function is used to render data to be used in place of the &lt;@
       @&gt; element.  you can use 'writesafe' to html  escape  the  data  before
       writing.  you can also use a simpler form &lt;@= that means use the result
       of the javascript expression, html escapse the data and then write  it.
       for example:

        &lt;p&gt;today is &lt;@= date() @&gt;

       even  simpler,  you can use an abbreviated @@variable to emit the value
       of a javascript variable. for example:

        &lt;p&gt;site url is @@{meta.url}&lt;/p&gt;

       the top url of the site may be abbreviated as '@~'.

<b>transformations</b>
       expansive will interpret document extensions and  automatically  trans-
       form  content  from  one  format to another.  for example, the filename
       'instructions.html.md' tells expansive that the  data  is  in  markdown
       format  via  the  '.md' extension and it should be converted to 'html'.
       expansive will examine each nested extension and process  the  document
       until it reaches an extension for which there is no further transforma-
       tions defined.

       expansive uses the '.exp' extension to specify the document has  embed-
       ded ejscript. for example:

        index.html.md.exp

       this  means the file has embedded ejscript in a markdown file that will
       be compiled to html. expansive will process this by first  running  the
       embedded  ejscript,  then piping the result through the markdown filter
       and finally saving the result as 'index.html' after applying the appro-
       priate layout.

<b>plugins</b>
       expansive  may be extended via plugins that provide transformations and
       additional scripting capability. a site specifies the  plugins  to  use
       via a 'control.plugins' meta property in its exp.json. when a plugin is
       installed via 'exp install', the plugin automatically  to  the  ordered
       'plugins'  list in package.json.  when a plugin is loaded, it registers
       itself to handle specific file extension transformations. the transfor-
       mation pipeline for specific extensions can be overridden via the

<b>useful plugins</b>
       here are some of the more useful expansive plugins:

       exp-bash  run shell scripts and capture the output

       exp-css   process  css files to add browser specific prefixs and minify
                 the  output.  requires  'autoprefixer'  and  'recess'  to  be
                 installed.

       exp-esp   compile esp web pages and applications.

       exp-gzip  compress  final  output using gzip. files are rendered with a
                 'gz' extension.

       exp-js    process javascript  files  to  mangle  and  minify.  requires
                 'uglify' to be installed.

       exp-less  process  less  stylesheets  into css. requires 'recess' to be
                 installed.

       exp-marked
                 install the markdown program. use with the exp-md plugin  for
                 markdown files.

       exp-md    process markdown files and emit html.

       exp-recess
                 install  the recess program. use with the exp-less plugin for
                 less file processing, and the exp-css file for minifying  css
                 files.

       exp-sass  process sass files into css. requires "sass" to be installed.

       exp-uglifyjs
                 install uglify-js. use with the exp-js plugin to  mangle  and
                 minify javascripts.

       many  plugins  can  be customized by passing configuration data via the
       meta data. for example: to request that minified javascript files use a
       '.min.js' extension and are compressed but not managed:

       {
           control: {
               services: {
                   'minify-js': {
                       compress: true,
                       mangle: true,
                       dotmin: true,
                   }
               }
           }
        }

        see  specific  plugin  documentation for the configuration options for
       each plugin.

<b>layouts</b>
       a layout page defines the top level html content for a  set  of  pages.
       the  layout  defines  the format, look and feel of the web site so that
       each pages does not need to replicate this content.  despite  the  fact
       that  pages  nominate  a layout page to use, it is actually layout page
       that includes the content page inside it to create  a  composite  page.
       the  '&lt;@  content @&gt;' tag in the layout is replaced with the actual web
       page data after separating the page meta data.

       there can be multiple layout pages and the  default  layout  is  called
       'default.html.exp'.  layout  pages  may next, i.e. may use other layout
       pages.  layout pages can use any desired transformation file extension.

             &lt;!doctype html&gt;
             &lt;html lang="en"&gt;
             &lt;head&gt;
                 &lt;title&gt;&lt;@= meta.title @&gt;&lt;/title&gt;
                 &lt;link href="css/api.css" rel="stylesheet" type="text/css" /&gt;
             &lt;/head&gt;
             &lt;body&gt;
                 &lt;div class="content"&gt;
                     &lt;@ content @&gt;
                 &lt;/div&gt;
             &lt;/body&gt;
             &lt;/html&gt;

<b>partials</b>
       web  pages  often  need  to have content that is common across a set of
       pages. expansive supports this via partial pages that can  be  included
       by  any  page, layout or other partial page. a page specifies a partial
       by using the 'partial' javascript function. for example:

        &lt;@ partial('header') @&gt;

       the partial function will search for a file starting with 'header.html'
       in  the  'partials'  directory.   partials are transformed according to
       their extension. if a partial called  'header.html.md.exp'  was  found,
       then  it  will  be  first transformed by running the embedded ejscript,
       then piping the output into the markdown to create html data that  will
       then be included in place of the original partial tag.

       partials can be nested, in that a partial page may include another par-
       ital page to any depth.

<b>meta data</b>
       pages, layouts and partials can define meta data at the top of the file
       via  a  javascript literal.  meta data is passed to the ejscript execu-
       tion context for each page, layout and partial where scripts can  exam-
       ine and use in rendering pages.

             {
                draft: true,
                navigation: 'blog',
             }
             &lt;h1&gt;page header&lt;/h1&gt;

       the  meta  data is added to the current meta data collection and passed
       to the layout page and any partials used by the page.   the  meta  data
       can be accessed via the 'expansive.meta' javascript property.

       meta data is inherited and aggregated as expansive processes a web site
       directory. the meta data from upper directories is passed down to lower
       directories.  in this manner upper levels can define the parameters for
       subdirectories in the site. meta data is never passed back up the tree.

       meta  data can also be defined by including additional 'exp.json' files
       at any level in the documents directory.

<b>meta properties</b>
       expansive defines a rich set of meta properties for you to use in  your
       pages:

       basename    basename portion of the public document filename.

       control     control collection specified in exp.json.

       date        generation date of the document.

       document    name  of  the  document  in  'documents' that is being pro-
                   cessed.

       extension   the extension of the public document filename.

       extensions  the set of extensions on the original input document.

       file        filename of the document or partial being processed.

       from        the filename  extension  being  processed  by  the  current
                   transformation.

       islayout    true if a layout is being processed.

       ispartial   true if a partial page is being processed.

       layout      layout page in use. set to '' if no layout being used.

       mode        index  in the modes property. the selected property collec-
                   tion is copied up to the top level of the meta data.

       modes       array of property  collections.  used  to  define  'debug',
                   'release' configurations.

       partial     name of the partial page being processed.

       path        input filename of the document.

       public      final public filename for the document.

       service     name of the transformation service being run.

       to          the  destination filename extension after processing by the
                   current transformation.

       top         url for the top level home page of the site.

       url         url for the current page.

<b>meta control</b>
       expansive defines a set of control properites in the meta.control:

       copy        array of patterns to copy without processing. the  patterns
                   may  include  "*"  or "**". if a directory is specifed, all
                   files under the directory are copied.

       dependencies
                   hash of file dependency relationships. the hash key is  the
                   document path and the value is a set of files that if modi-
                   fied, cause the document to be rendered. the  document  and
                   files  are  relative to the documents directory. the set of
                   files can be a string or an array of files. each value file
                   may contain "*" or "**".

       directories directories  collection.  entries for 'documents', 'files',
                   'public', 'layouts', and 'partials'.

       exclude     array of patterns to exclude from processing. the  patterns
                   may  include  "*"  or "**". if a directory is specifed, all
                   files under the directory are excluded.

       listen      address on which to listen for http requests. may be just a
                   port number.

       plugins     list of plugins to use.

       script      script  to  evaluate  to  inject  code  into  the expansive
                   ejscript global execution context.

       sitemap     control what files to include in a sitemap.

       transforms  hash of extension mappings to a list of transform  services
                   for  those mappings. mappings are in the form 'ext -&gt; ext'.
                   for example:

                    transforms: {
                       'less -&gt; css': [ 'compile-less', 'prefix-css', 'minify-
                   css', 'compress' ]
                    }

                   some  of  the standard service names are: compile-esp, com-
                   pile-less,   compile-markdown,   compile-sass,    compress,
                   minify-css, minify-js, prefix-css, shell.

       watch       time  in  milliseconds to wait between checking for render-
                   ing.

<b>creating plugins</b>
       expansive   plugins    are    created    using    the    pak    utility
       (https://embedthis.com/pak)   and  published  to  the  pak  catalog  at
       (https://embedthis.com/catalog/). the plugin  contains  a  package.json
       file that includes an app.expansive property collection. for example:

        {
           control: {
               transforms: {
                   name:       'my-transform',
                   from:       'ext1',
                   to:         'ext2',
                   script:     '
                       function transform(contents, meta, service) {
                           return transformed data
                       }
                   '
               }
           }
        }

       the plugin specifies a one or more transformations via the 'transforms'
       collection. each transform definition provides  an  implemention  of  a
       transform  service. the 'name' property specifies the transform service
       name. the service name provides an abstract  name  for  which  multiple
       plugins may provide the implementation. the service is selected via the
       'plugins' property and expansive chooses the first plugin  that  adver-
       tized that service.

       the  'from'  property specifies the starting filename extension and the
       'to' property specifies the ending extension.  if  all  extensions  are
       supported,  set the value to '*'. both 'from' and 'to' may be arrays if
       multiple extensions are supported.

       the transform script should define a global 'transform'  function  that
       will  be  invoked  for  matching content.  it is invoked with the 'con-
       tents' to transform (string), the meta data collection and the  service
       object  that  contains service options.  the function should return the
       transformed data.

       a plugin may also define other  ejscript  functions  and  variables  in
       'script'  that will be injected into the global scope of expansive when
       it executes.

<b>scripting</b>
       expansive defines a top level global named "expansive" to access expan-
       sive  services. this object provides the following properties and meth-
       ods:

       additems(collection, items)
              add items  to  a  named  collection.  collections  are  globally
              defined  and reset at the start of processing for each document.
              documents, partials and layouts can inject  items  into  collec-
              tions  for  sharing to other documents. items may be a string or
              an array of strings. items are uniquely added to the collection.

       getfilemeta(filename)
              to return the meta data specified in the given file.

       getitems(collection)
              return the items in a named collection as an array.

       getfiles({key: value})
              to  return  a  list  of  matching  documents that have meta data
              matching the specified keys and values.

       removeitems(collection, items)
              remove the specified items from the named collection.

       renderscripts
              render  all  scripts  added  to  the  'scripts'  collection  via
              'additems'.  this  permits  documents,  partials  and layouts to
              require javascripts and have them emitted uniquely by a partial.

       renderstyles
              render all stylesheets added to the 'styles' and 'inline-styles'
              collections via 'additems'. this permits documents, partials and
              layouts to require stylesheets and have them emitted uniquely by
              a partial.

       trace(tag, msg...)
              to emit console trace while processing.

<b>commands</b>
       clean  remove rendered content from the 'public' output directory.

       init   initialize a directory by creating an  'exp.json'  configuration
              file.

       install
              install a plugin from the pak catalog.

       render render the site by processing files from 'documents', 'layouts',
              'partials' and 'files' into the 'public' output directory.

       uninstall
              uninstall a plugin from the exp.json  plugin  list.  the  plugin
              remains in the local pak cache.

       upgrade
              upgrade a plugin version in the local pak cache.

       watch  watch  for  changes to 'documents', 'layouts' and 'partials' and
              render the modified files. changes to  'layouts'  or  'partials'
              will cause the entire site to be rendered.

       &lt;cr&gt;   running  exp  without  any arguments will cause run the embedded
              web server to serve the site. by default expansive  will  listen
              on  port 4000. this can be modified via the 'listen' property in
              the meta collection.

       patterns ...
              providing a list of patterns to filter the set of  documents  to
              render.   expansive  will  render  only the documents that begin
              with the given patterns.

<b>options</b>
       <b>--chdir directory</b>
                 change to directory before running.

       <b>--keep uri</b>
                 keep intermediate files when transforming content. useful for
                 debugging.

       <b>--listen ip:port uri</b>
                 change  the port on which expansive will listen. can omit the
                 ip portion and only specify a port.

       <b>--log filename:level</b>
                 emit trace to the specified file. the level  is  a  verbosity
                 level from 0-5 with 5 being the most verbose.

       <b>--noclean </b>do  not  clean  the  'public'  directory before rendering. by
                 default expansive will remove all the content under  'public'
                 first.

       <b>--norender</b>
                 do not do an initial render before watching for changes.

       <b>--nowatch </b>do not watch for changes when serving content.

       <b>--quiet   </b>run in quiet mode. do not emit activity trace to the console.

       <b>--trace filename:level</b>
                 trace http requests to the specified file.  the  level  is  a
                 verbosity level from 0-5 with 5 being the most verbose.  http
                 requests and http headers will be traced at levels 2-4.

       <b>--verbose </b>run in verbose mode. emit more activity trace.

       <b>--versions uri</b>
                 show exp version information.

       <b>--digit   </b>emit log and http trace to stderr at the specified level. the
                 digit  must  be  0  to 5 with 5 being the most verbose.  this
                 option  is  the   same   as   "--log   stderr:digit   --trace
                 stderr:digit"

<b>reporting bugs</b>
       report bugs to dev@embedthis.com.

<b>copyright</b>
       copyright  (c)  2004-2014  embedthis  software.  bit and ejscript are a
       trademarks of embedthis software.

<b>see also</b>
       ejs, me, http://embedthis.com/exp/

exp                               march 2014                            exp(1)
</pre></body>
</html>